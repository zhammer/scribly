<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'head.html' %}
  </head>
  <body>
    <h1>{{ story.title }}</h1>
    <hr />
    <h3>
      cowriters: {{ story.cowriters|map(attribute='username')|join(', ')}}
    </h3>
    <h4>
        {% if story.state == "in_progress" %}
        turn: {{ story.turns | length }} ({{ story.current_writers_turn.username}}'s turn)
        {% endif %}
        {% if story.state == "done"  %}
        story is finished, {{ story.turns | length }} turns
        {% endif %}
    </h4>
    <hr />
    {% set turn_separator = joiner("~~") %}
    {% for turn in story.turns %}
    {{ turn_separator() }}
    {% if turn.action in ["write", "write_and_finish"] %}
    <p>{{ turn.text_written }}</p>
    {% endif %}
    {% if turn.action == "pass" %}
    <p class="faded">pass</p>
    {% endif %}
    {% if turn.action in ["finish", "write_and_finish"] %}
    <p class="faded">fin</p>
    {% endif %}
    {% endfor %}
    {% if story.state == "in_progress" and story.current_writers_turn.id == user.id %}
    <form
      id="turn-form"
      class="simple-form"
      action="/stories/{{ story.id }}/turn"
      method="post"
    >
      <textarea
        name="text"
        id="text"
        class="writer"
        placeholder="write your turn here"
      ></textarea>
      <div class="flex">
        <button
          type="submit"
          id="write"
          name="action"
          value="write"
          onclick="return confirm('Once you\'ve submitted your turn, your text can\'t be edited. Are you sure you want to continue?');"
        >
          write
        </button>
        <button
          type="submit"
          id="write-and-finish"
          name="action"
          value="write_and_finish"
          onclick="return confirm('This will finish the story. Are you sure you want to continue?');"
        >
          write and finish
        </button>
        <button
          type="submit"
          id="finish"
          name="action"
          value="finish"
          onclick="return confirm('This will finish the story and will IGNORE any text you\'ve written for this turn. Are you sure you want to continue?');"
        >
          finish
        </button>
        <button
          type="submit"
          id="pass"
          name="action"
          value="pass"
          onclick="return confirm('This will pass over your turn and will IGNORE any text you\'ve written for this turn. Are you sure you want to continue?');"
        >
          pass
        </button>
      </div>
    </form>
    {% endif %}
  </body>
</html>
